<?xml version="1.0" encoding="utf-8"?>
<diff>
	<replace sel="/aiscript/init//set_value[@name='$blockingorders']">
		<set_value name="$blockingorders" exact="['Wait', 'Escort', 'TradeRoutine', 'TradeRoutine_Basic', 'TradeRoutine_Advanced', 'TradeRoutine_BasicMid', 'TradeRoutine_Standard', 'TradeRoutine_Expert', 'Middleman', 'MiningRoutine', 'MiningRoutine_Basic', 'MiningRoutine_Advanced', 'MiningRoutine_Expert', 'MiningRoutine_BasicMid', 'MiningRoutine_Standard']"/>
	</replace>

	<replace sel="/aiscript/patch[@sinceversion='5']//set_value[@name='$blockingorders']">
		<set_value name="$blockingorders" exact="['Wait', 'Escort', 'TradeRoutine', 'TradeRoutine_Basic', 'TradeRoutine_Advanced', 'TradeRoutine_BasicMid', 'TradeRoutine_Standard', 'TradeRoutine_Expert', 'Middleman', 'MiningRoutine', 'MiningRoutine_Basic', 'MiningRoutine_Advanced', 'MiningRoutine_Expert', 'MiningRoutine_BasicMid', 'MiningRoutine_Standard']"/>
	</replace>
</diff>﻿<?xml version="1.0" encoding="utf-8"?>
<diff>

	<replace sel="/aiscript/attention//do_elseif[@value=&quot;($orderdef.$id == 'TradeRoutine') or ($orderdef.$id == 'TradeRoutine_Basic') or ($orderdef.$id == 'TradeRoutine_Advanced')&quot;]">
		<do_elseif value="($orderdef.$id == 'TradeRoutine') or ($orderdef.$id == 'TradeRoutine_Basic') or ($orderdef.$id == 'TradeRoutine_Advanced') or ($orderdef.$id == 'TradeRoutine_BasicMid') or ($orderdef.$id == 'TradeRoutine_Standard') or ($orderdef.$id == 'TradeRoutine_Expert')">
			<do_if value="$createdefaultorder? or (not $incompatiblewaretransport?)">
				<set_value name="$added"/>
				<do_if value="@this.assignedcontrolled.order.isrunning">
					<clear_order_failure order="this.assignedcontrolled.order"/>
				</do_if>
				<do_if value="@$order.$warebasket_override.count or @$orderdef.$warebasket_override.count">
					<do_if value="$createdefaultorder?">
						<create_order id="$orderdef.$id" object="this.assignedcontrolled" default="true">
							<param name="warebasket" value="$orderdef.$warebasket"/>
							<param name="range" value="$orderdef.$range"/>
							<param name="minbuy" value="$orderdef.$minbuy"/>
							<param name="maxbuy" value="$orderdef.$maxbuy"/>
							<param name="minsell" value="$orderdef.$minsell"/>
							<param name="maxsell" value="$orderdef.$maxsell"/>
							<param name="tradeforbuildstorage" value="$orderdef.$tradeforbuildstorage"/>
							<param name="usecover" value="$orderdef.$usecover"/>
							<param name="warebasket_override" value="$orderdef.$warebasket_override"/>
							<do_if value="$orderdef.$id == 'TradeRoutine_Standard'">
								<param name="maxwares" value="$orderdef.$maxwares"/>
							</do_if>
						</create_order>
					</do_if>
					<do_else>
						<set_value name="$orderdef.$warebasket" exact="$order.$warebasket"/>
						<set_value name="$orderdef.$range" exact="$order.$range"/>
						<set_value name="$orderdef.$minbuy" exact="$order.$minbuy"/>
						<set_value name="$orderdef.$maxbuy" exact="$order.$maxbuy"/>
						<set_value name="$orderdef.$minsell" exact="$order.$minsell"/>
						<set_value name="$orderdef.$maxsell" exact="$order.$maxsell"/>
						<set_value name="$orderdef.$tradeforbuildstorage" exact="$order.$tradeforbuildstorage"/>
						<set_value name="$orderdef.$usecover" exact="$order.$usecover"/>
						<set_value name="$orderdef.$warebasket_override" exact="$order.$warebasket_override"/>
						<do_if value="$orderdef.$id == 'TradeRoutine_Standard'">
							<set_value name="$orderdef.$maxwares" exact="$order.$maxwares"/>
						</do_if>
						<run_script name="$scriptname" sinceversion="2">
							<param name="warebasket" value="$order.$warebasket"/>
							<param name="range" value="$order.$range"/>
							<param name="minbuy" value="$order.$minbuy"/>
							<param name="maxbuy" value="$order.$maxbuy"/>
							<param name="minsell" value="$order.$minsell"/>
							<param name="maxsell" value="$order.$maxsell"/>
							<param name="tradeforbuildstorage" value="$order.$tradeforbuildstorage"/>
							<param name="usecover" value="$order.$usecover"/>
							<param name="warebasket_override" value="$order.$warebasket_override"/>
							<do_if value="$orderdef.$id == 'TradeRoutine_Standard'">
								<param name="maxwares" value="$order.$maxwares"/>
							</do_if>
						</run_script>
					</do_else>
				</do_if>
				<do_else>
					<do_if value="$createdefaultorder?">
						<create_order id="$orderdef.$id" object="this.assignedcontrolled" default="true">
							<param name="warebasket" value="$orderdef.$warebasket"/>
							<param name="range" value="$orderdef.$range"/>
							<param name="minbuy" value="$orderdef.$minbuy"/>
							<param name="maxbuy" value="$orderdef.$maxbuy"/>
							<param name="minsell" value="$orderdef.$minsell"/>
							<param name="maxsell" value="$orderdef.$maxsell"/>
							<param name="tradeforbuildstorage" value="$orderdef.$tradeforbuildstorage"/>
							<param name="usecover" value="$orderdef.$usecover"/>
							<do_if value="$orderdef.$id == 'TradeRoutine_Standard'">
								<param name="maxwares" value="$orderdef.$maxwares"/>
							</do_if>
						</create_order>
					</do_if>
					<do_else>
						<set_value name="$orderdef.$warebasket" exact="$order.$warebasket"/>
						<set_value name="$orderdef.$range" exact="$order.$range"/>
						<set_value name="$orderdef.$minbuy" exact="$order.$minbuy"/>
						<set_value name="$orderdef.$maxbuy" exact="$order.$maxbuy"/>
						<set_value name="$orderdef.$minsell" exact="$order.$minsell"/>
						<set_value name="$orderdef.$maxsell" exact="$order.$maxsell"/>
						<set_value name="$orderdef.$tradeforbuildstorage" exact="$order.$tradeforbuildstorage"/>
						<set_value name="$orderdef.$usecover" exact="$order.$usecover"/>
						<do_if value="$orderdef.$id == 'TradeRoutine_Standard'">
							<set_value name="$orderdef.$maxwares" exact="$order.$maxwares"/>
						</do_if>
						<run_script name="$scriptname">
							<param name="warebasket" value="$order.$warebasket"/>
							<param name="range" value="$order.$range"/>
							<param name="minbuy" value="$order.$minbuy"/>
							<param name="maxbuy" value="$order.$maxbuy"/>
							<param name="minsell" value="$order.$minsell"/>
							<param name="maxsell" value="$order.$maxsell"/>
							<param name="tradeforbuildstorage" value="$order.$tradeforbuildstorage"/>
							<param name="usecover" value="$order.$usecover"/>
							<do_if value="$orderdef.$id == 'TradeRoutine_Standard'">
								<param name="maxwares" value="$order.$maxwares"/>
							</do_if>
						</run_script>
					</do_else>
				</do_else>
			</do_if>
		</do_elseif>
	</replace>
	
	
	
	<replace sel="/aiscript/attention//do_elseif[@value=&quot;($orderdef.$id == 'MiningRoutine') or ($orderdef.$id == 'MiningRoutine_Advanced') or ($orderdef.$id == 'MiningRoutine_Basic') or ($orderdef.$id == 'MiningRoutine_Expert')&quot;]">
		<do_elseif value="($orderdef.$id == 'MiningRoutine') or ($orderdef.$id == 'MiningRoutine_Advanced') or ($orderdef.$id == 'MiningRoutine_Basic') or ($orderdef.$id == 'MiningRoutine_Expert') or ($orderdef.$id == 'MiningRoutine_BasicMid') or ($orderdef.$id == 'MiningRoutine_Standard')">
			<do_if value="(this.assignedcontrolled.primarypurpose == purpose.mine) and ($createdefaultorder? or (not $incompatiblewaretransport?) or ($commander.waretransport.indexof.{waretransport.solid} and this.assignedcontrolled.waretransport.indexof.{waretransport.solid}) or ($commander.waretransport.indexof.{waretransport.liquid} and this.assignedcontrolled.waretransport.indexof.{waretransport.liquid}))">
				<set_value name="$added"/>
				<do_if value="@this.assignedcontrolled.order.isrunning">
					<clear_order_failure order="this.assignedcontrolled.order"/>
				</do_if>
				<do_if value="@$order.$warebasket_override.count or @$orderdef.$warebasket_override.count">
					<do_if value="$createdefaultorder?">
						<create_order id="$orderdef.$id" object="this.assignedcontrolled" default="true">
							<param name="warebasket" value="$orderdef.$warebasket"/>
							<param name="range" value="$orderdef.$range"/>
							<param name="minbuy" value="$orderdef.$minbuy"/>
							<param name="maxbuy" value="$orderdef.$maxbuy"/>
							<param name="minsell" value="$orderdef.$minsell"/>
							<param name="maxsell" value="$orderdef.$maxsell"/>
							<param name="warebasket_override" value="$orderdef.$warebasket_override"/>
							<do_if value="$orderdef.$id == 'MiningRoutine_Standard'">
								<param name="maxwares" value="$orderdef.$maxwares"/>
							</do_if>
						</create_order>
					</do_if>
					<do_else>
						<set_value name="$orderdef.$warebasket" exact="$order.$warebasket"/>
						<set_value name="$orderdef.$range" exact="$order.$range"/>
						<set_value name="$orderdef.$minbuy" exact="$order.$minbuy"/>
						<set_value name="$orderdef.$maxbuy" exact="$order.$maxbuy"/>
						<set_value name="$orderdef.$minsell" exact="$order.$minsell"/>
						<set_value name="$orderdef.$maxsell" exact="$order.$maxsell"/>
						<set_value name="$orderdef.$warebasket_override" exact="$order.$warebasket_override"/>
						<do_if value="$orderdef.$id == 'MiningRoutine_Standard'">
							<set_value name="$orderdef.$maxwares" exact="$order.$maxwares"/>
						</do_if>
						<run_script name="$scriptname" sinceversion="2">
							<param name="warebasket" value="$order.$warebasket"/>
							<param name="range" value="$order.$range"/>
							<param name="minbuy" value="$order.$minbuy"/>
							<param name="maxbuy" value="$order.$maxbuy"/>
							<param name="minsell" value="$order.$minsell"/>
							<param name="maxsell" value="$order.$maxsell"/>
							<param name="warebasket_override" value="$order.$warebasket_override"/>
							<do_if value="$orderdef.$id == 'MiningRoutine_Standard'">
								<param name="maxwares" value="$order.$maxwares"/>
							</do_if>
						</run_script>
					</do_else>
				</do_if>
				<do_else>
					<do_if value="$createdefaultorder?">
						<create_order id="$orderdef.$id" object="this.assignedcontrolled" default="true">
							<param name="warebasket" value="$orderdef.$warebasket"/>
							<param name="range" value="$orderdef.$range"/>
							<param name="minbuy" value="$orderdef.$minbuy"/>
							<param name="maxbuy" value="$orderdef.$maxbuy"/>
							<param name="minsell" value="$orderdef.$minsell"/>
							<param name="maxsell" value="$orderdef.$maxsell"/>
							<do_if value="$orderdef.$id == 'MiningRoutine_Standard'">
								<param name="maxwares" value="$orderdef.$maxwares"/>
							</do_if>
						</create_order>
					</do_if>
					<do_else>
						<set_value name="$orderdef.$warebasket" exact="$order.$warebasket"/>
						<set_value name="$orderdef.$range" exact="$order.$range"/>
						<set_value name="$orderdef.$minbuy" exact="$order.$minbuy"/>
						<set_value name="$orderdef.$maxbuy" exact="$order.$maxbuy"/>
						<set_value name="$orderdef.$minsell" exact="$order.$minsell"/>
						<set_value name="$orderdef.$maxsell" exact="$order.$maxsell"/>
						<do_if value="$orderdef.$id == 'MiningRoutine_Standard'">
							<set_value name="$orderdef.$maxwares" exact="$order.$maxwares"/>
						</do_if>
						<run_script name="$scriptname">
							<param name="warebasket" value="$order.$warebasket"/>
							<param name="range" value="$order.$range"/>
							<param name="minbuy" value="$order.$minbuy"/>
							<param name="maxbuy" value="$order.$maxbuy"/>
							<param name="minsell" value="$order.$minsell"/>
							<param name="maxsell" value="$order.$maxsell"/>
							<do_if value="$orderdef.$id == 'MiningRoutine_Standard'">
								<param name="maxwares" value="$order.$maxwares"/>
							</do_if>
						</run_script>
					</do_else>
				</do_else>
			</do_if>
			<do_elseif value="this.assignedcontrolled.primarypurpose != purpose.mine">
				<set_value name="$failurereason" exact="{1045,158}" comment="This ship type cannot mine."/>
			</do_elseif>
			<do_elseif value="$incompatiblewaretransport?">
				<set_value name="$failurereason" exact="{1045,156}" comment="This ship type cannot carry the required wares."/>
			</do_elseif>
		</do_elseif>
	</replace>
</diff>﻿<?xml version="1.0" encoding="utf-8"?>
<diff>
	<replace sel="/aiscript/attention/actions/do_else/do_if[@value=&quot;this.isplayerowned and this.shouldinformplayer and (@this.ship.defaultorder.id != 'TradeRoutine') and (@this.ship.defaultorder.id != 'TradeRoutine_Basic') and (@this.ship.defaultorder.id != 'TradeRoutine_Advanced') and (@this.ship.defaultorder.id != 'Middleman')&quot;]">
		<do_if value="this.isplayerowned and this.shouldinformplayer and (@this.ship.defaultorder.id != 'TradeRoutine') and (@this.ship.defaultorder.id != 'TradeRoutine_Basic') and (@this.ship.defaultorder.id != 'TradeRoutine_BasicMid') and (@this.ship.defaultorder.id != 'TradeRoutine_Standard') and (@this.ship.defaultorder.id != 'TradeRoutine_Expert') and (@this.ship.defaultorder.id != 'TradeRoutine_Advanced') and (@this.ship.defaultorder.id != 'Middleman')">
			<set_value name="$tradeorders" exact="this.ship.tradeorders"/>
			<do_if value="$tradeorders.count == 0 or ($tradeorders.count == 1 and $tradeorders.{1} == this.ship.order)">
				<set_value name="$logtext" exact="[this.name, '', this.ship.name, '', {1015,32}]"/>
				<set_value name="$tickertext" exact="$logtext.clone"/>
				<set_value name="$tickertext.{1}" operation="insert" exact="{1015,31}"/>
				<set_value name="$tickertext.{2}" operation="insert" exact="''"/>
				<do_if value="notification.trade_queue_completed.active">
					<show_notification text="$tickertext" sound="notification_achievement"/>
				</do_if>
				<write_to_logbook category="general" title="{1015,31}" text="$logtext"/>
			</do_if>
		</do_if>
	</replace>
</diff>﻿<?xml version="1.0" encoding="utf-8" ?>
<aiscript name="order.trade.routine.basicmid" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="aiscripts.xsd" version="1">
	<order id="TradeRoutine_BasicMid" name="{1819190163, 1}" description="{1819190163, 2}" category="trade" allowinloop="false">
		<params>
			<param name="warebasket" required="true" default="this.ship.warebasket.random" type="ware" text="{1041, 10144}" comment="Ware. Resource that we will supply.">
				<input_param name="cancarry" value="this.ship"/>
			</param>
			<param name="range" default="if @this.ship.commanderentity.$config_subordinate_range then @this.ship.commanderentity.$config_subordinate_range 
             else (if @this.ship.commander.isclass.[class.station, class.buildstorage] then this.ship.commander.sector else (if this.ship.jobmainsector then this.ship.jobmainsector else this.sector))" type="sector" text="{1041, 10005}" comment="Anchor space"/>
			<param name="minbuy" default="0" type="internal" text="{1041, 10067}" comment="Min gate distance to gather resources. Gathering range supported if $minsell and $maxsell are provided"/>
			<param name="maxbuy" default="[([@this.ship.commander.tradenpc.skill.management, @this.ship.pilot.skill.piloting].max / 3), 0].max" type="number" text="{1041, 10054}" comment="Max gate distance to buy. Gathering range supported if $minsell and $maxsell are provided">
				<input_param name="startvalue" value="0"/>
				<input_param name="min" value="0"/>
				<input_param name="max" value="[([@this.ship.commander.tradenpc.skill.management, @this.ship.pilot.skill.piloting].max / 3), 0].max"/>
				<input_param name="step" value="1"/>
			</param>
			<param name="minsell" default="0" type="internal" text="{1041, 10069}" comment="Min gate distance to sell resources. Sell range supported if $minsell and $maxsell are provided"/>
			<param name="maxsell" default="[@this.ship.commander.tradenpc.skill.management, @this.ship.pilot.skill.piloting].max / 3" type="number" text="{1041, 10058}" comment="Max gate distance to sell resources. Sell range supported if $minsell and $maxsell are provided">
				<input_param name="startvalue" value="0"/>
				<input_param name="min" value="0"/>
				<input_param name="max" value="[@this.ship.commander.tradenpc.skill.management, @this.ship.pilot.skill.piloting].max / 3"/>
				<input_param name="step" value="1"/>
			</param>

			<param name="duration" default="0s" type="time" infinitevalue="0s" advanced="true" text="{1041, 10034}" comment="Duration">
				<input_param name="startvalue" value="0s"/>
				<input_param name="min" value="0s"/>
				<input_param name="max" value="24h"/>
				<input_param name="step" value="1min"/>
			</param>
			<param name="tradeforbuildstorage" default="null" type="internal" comment="Only used for trade.find.commander. Set to look for trade offers on the connected build storage rather than on the commander."/>
			<param name="usecover" default="false" type="internal" text="Use Cover" comment="used by smugglers"/>
			<param name="debugchance" type="bool" default="0" advanced="true" text="{1041, 10086}" comment="Print debug output">
				<input_param name="truevalue" value="100"/>
			</param>
			<param name="debugchance2" type="bool" default="0" advanced="true" text="{1041, 10142}" comment="Verbose debug output">
				<input_param name="truevalue" value="100"/>
			</param>
		</params>
		<skill min="20"/>
		<requires>
			<match shiptype="shiptype.lasertower" negate="true"/>
			<match class="class.spacesuit" negate="true"/>
		</requires>
	</order>
	<patch sinceversion="1">
		<do_if value="not $range">
			<do_if value="this.sector">
				<set_value name="$range" exact="this.sector"/>
			</do_if>
			<do_elseif value="this.zone.isclass.highway">
				<set_value name="$range" exact="this.zone.destination.sector"/>
			</do_elseif>
			<do_else>
				<debug_text text="'PATCH: failed trying to set $range. ship is neither in a sector nor a highway. parent: %s %s %s'.[@this.assignedcontrolled.parent.knownname, this.assignedcontrolled.parent, this.assignedcontrolled.parent.macro]" filter="error"/>
			</do_else>
			<do_if value="this.assignedcontrolled.defaultorder.id == 'TradeRoutine_BasicMid'">
				<edit_order_param order="this.assignedcontrolled.defaultorder" param="'range'" value="$range"/>
			</do_if>
		</do_if>
	</patch>
	<attention min="unknown">
		<actions>
			<do_if value="not @$warebasket.count">
				<set_value name="$warebasket" exact="[$warebasket]"/>
			</do_if>
			<do_else>
				<set_value name="$warebasket" exact="[$warebasket.random]"/>
			</do_else>
			<run_script name="'order.trade.routine'">
				<param name="warebasket" value="$warebasket"/>
				<param name="range" value="$range"/>
				<param name="minbuy" value="$minbuy"/>
				<param name="maxbuy" value="$maxbuy"/>
				<param name="minsell" value="$minsell"/>
				<param name="maxsell" value="$maxsell"/>
				<param name="duration" value="$duration"/>
				<param name="tradeforbuildstorage" value="$tradeforbuildstorage"/>
				<param name="usecover" value="$usecover"/>
				<param name="debugchance" value="$debugchance"/>
				<param name="debugchance2" value="$debugchance2"/>
			</run_script>
		</actions>
	</attention>
</aiscript>
﻿<?xml version="1.0" encoding="utf-8"?>
<diff>

	<add sel="/aiscript/order/params">
		<param name="effectiveskill" default="this.ship.combinedskill" type="internal" comment="Effective skill level used for range factor (Expert = 100)"/>
	</add>


	<replace sel="/aiscript/init//do_if[@value=&quot;(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced')&quot;]">
		<do_if value="(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced') or (this.assignedcontrolled.order.id == 'TradeRoutine_BasicMid') or (this.assignedcontrolled.order.id == 'TradeRoutine_Standard') or (this.assignedcontrolled.order.id == 'TradeRoutine_Expert')">
			<set_value name="$thisorder" exact="this.assignedcontrolled.order"/>
		</do_if>
	</replace>

	<replace sel="/aiscript/patch[@sinceversion='10']//do_if[@value=&quot;(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced')&quot;]">
		<do_if value="(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced') or (this.assignedcontrolled.order.id == 'TradeRoutine_BasicMid') or (this.assignedcontrolled.order.id == 'TradeRoutine_Standard') or (this.assignedcontrolled.order.id == 'TradeRoutine_Expert')">
			<set_value name="$thisorder" exact="this.assignedcontrolled.order"/>
		</do_if>
	</replace>

	<replace sel="/aiscript/attention//do_if[@value=&quot;(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced')&quot;]">
		<do_if value="(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced') or (this.assignedcontrolled.order.id == 'TradeRoutine_BasicMid') or (this.assignedcontrolled.order.id == 'TradeRoutine_Standard') or (this.assignedcontrolled.order.id == 'TradeRoutine_Expert')">
			<set_order_syncpoint_reached order="this.assignedcontrolled.order"/>
		</do_if>
	</replace>

	<replace sel="/aiscript/init/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']">
		<set_value name="$maxrange" exact="[@this.assignedcontrolled.commander.tradenpc.skill.management, @this.skill.piloting].max / 3"/>
	</replace>
	<add sel="/aiscript/init/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']" position="after">
		<do_if value="$effectiveskill == 100">
			<set_value name="$maxrange" exact="$maxrange * 2"/>
		</do_if>
	</add>

	<replace sel="/aiscript/patch[@sinceversion='7']/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']">
		<set_value name="$maxrange" exact="[@this.assignedcontrolled.commander.tradenpc.skill.management, @this.assignedcontrolled.pilot.skill.piloting].max / 3"/>
	</replace>
	<add sel="/aiscript/patch[@sinceversion='7']/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']" position="after">
		<do_if value="$effectiveskill == 100">
			<set_value name="$maxrange" exact="$maxrange * 2"/>
		</do_if>
	</add>
</diff>
﻿<?xml version="1.0" encoding="utf-8"?>
<diff>
	<replace sel="//library[@name='ShowOverlay']//do_elseif[@value=&quot;$Order.id == 'TradeRoutine' or $Order.id == 'TradeRoutine_Expert' or $Order.id == 'TradeRoutine_Basic' or $Order.id == 'TradeRoutine_Advanced'&quot;]">
		<do_elseif value="$Order.id == 'TradeRoutine' or $Order.id == 'TradeRoutine_Basic' or $Order.id == 'TradeRoutine_Advanced' or $Order.id == 'TradeRoutine_BasicMid' or $Order.id == 'TradeRoutine_Standard' or $Order.id == 'TradeRoutine_Expert'">
			<set_value name="$Wares" exact="''"/>
			<do_if value="$Order.$warebasket.count gt 0">
				<do_for_each name="$Ware" in="$Order.$warebasket" counter="$Index">
					<do_if value="$Index lt $Order.$warebasket.count">
						<set_value name="$Wares" exact="$Wares + '%s, '.[$Ware]"/>
					</do_if>
					<do_else>
						<set_value name="$Wares" exact="$Wares + '%s'.[$Ware]"/>
					</do_else>
				</do_for_each>
				<set_value name="$StatusText" exact="$Order.name + {1001,120} + ' ' + $Wares"/>
			</do_if>
			<do_else>
				<set_value name="$StatusText" exact="$Order.name"/>
			</do_else>
		</do_elseif>
	</replace>

	<replace sel="//library[@name='ShowOverlay']//do_elseif[@value=&quot;$Order.id == 'MiningRoutine' or $Order.id == 'MiningRoutine_Expert' or $Order.id == 'MiningRoutine_Basic' or $Order.id == 'MiningRoutine_Advanced'&quot;]">
		<do_elseif value="$Order.id == 'MiningRoutine' or $Order.id == 'MiningRoutine_Basic' or $Order.id == 'MiningRoutine_Advanced' or $Order.id == 'MiningRoutine_BasicMid' or $Order.id == 'MiningRoutine_Standard' or $Order.id == 'MiningRoutine_Expert'">
			<set_value name="$Wares" exact="''"/>
			<do_if value="not @$Order.$warebasket.count">
				<set_value name="$Wares" exact="$Order.$warebasket"/>
			</do_if>
			<do_if value="@$Order.$warebasket.count and $Order.$warebasket.count gt 0">
				<do_for_each name="$Ware" in="$Order.$warebasket" counter="$Index">
					<do_if value="$Index lt $Order.$warebasket.count">
						<set_value name="$Wares" exact="$Wares + '%s, '.[$Ware]"/>
					</do_if>
					<do_else>
						<set_value name="$Wares" exact="$Wares + '%s'.[$Ware]"/>
					</do_else>
				</do_for_each>
			</do_if>
			<do_if value="$Wares != ''">
				<set_value name="$StatusText" exact="$Order.name + {1001,120} + ' ' + $Wares"/>
			</do_if>
			<do_else>
				<set_value name="$StatusText" exact="$Order.name"/>
			</do_else>
		</do_elseif>
	</replace>
</diff>﻿<?xml version="1.0" encoding="utf-8"?>
<diff>
	<!-- MINING: 40+/20+ avec vérification post-création et fallbacks -->
	<add sel="/mdscript/cues/cue[@name='Start']/patch[@sinceversion='4']//do_elseif[@value=&quot;@$playerminers.{$i}.pilot.combinedskill ge 60&quot;]" pos="after">
		<do_elseif value="@$playerminers.{$i}.pilot.combinedskill ge 40">
			<create_order object="$playerminers.{$i}" id="'MiningRoutine_Standard'" default="true">
				<param name="maxwares" value="$defaultorder.$maxwares"/>
				<param name="warebasket" value="$defaultorder.$warebasket"/>
				<param name="range" value="$defaultorder.$range"/>
				<param name="minbuy" value="$defaultorder.$minbuy"/>
				<param name="maxbuy" value="$defaultorder.$maxbuy"/>
				<param name="minsell" value="$defaultorder.$minsell"/>
				<param name="maxsell" value="$defaultorder.$maxsell"/>
				<param name="debugchance" value="$defaultorder.$debugchance"/>
				<param name="debugchance2" value="$defaultorder.$debugchance2"/>
			</create_order>
			<do_if value="@$playerminers.{$i}.defaultorder.id != 'MiningRoutine_Standard'">
				<set_value name="$refsector" exact="@$playerminers.{$i}.sector"/>
				<do_if value="not $refsector and $playerminers.{$i}.zone.issuperhighway and $playerminers.{$i}.zone.destination and $playerminers.{$i}.zone.destination.sector">
					<set_value name="$refsector" exact="$playerminers.{$i}.zone.destination.sector"/>
				</do_if>
				<set_value name="$locbasket" exact="if $defaultorder.$warebasket.count then $defaultorder.$warebasket.random else $defaultorder.$warebasket"/>
				<do_if value="$refsector.exists and $defaultorder.$warebasket.count">
					<do_all exact="$defaultorder.$warebasket.count" counter="$j">
						<find_closest_resource ware="$defaultorder.$warebasket.{$j}" refobject="$playerminers.{$i}" sector="$resourcesector" position="$resourcepos"/>
						<do_if value="$resourcesector.exists and ($refsector == $resourcesector)">
							<set_value name="$locbasket" exact="$defaultorder.$warebasket.{$j}"/>
							<break/>
						</do_if>
					</do_all>
				</do_if>
				<create_order object="$playerminers.{$i}" id="'MiningRoutine_BasicMid'" default="true">
					<param name="warebasket" value="$locbasket"/>
					<param name="range" value="$refsector"/>
					<param name="minbuy" value="0"/>
					<param name="maxbuy" value="0"/>
					<param name="minsell" value="0"/>
					<param name="maxsell" value="0"/>
					<param name="debugchance" value="$defaultorder.$debugchance"/>
					<param name="debugchance2" value="$defaultorder.$debugchance2"/>
				</create_order>
				<do_if value="@$playerminers.{$i}.defaultorder.id != 'MiningRoutine_BasicMid'">
					<create_order object="$playerminers.{$i}" id="'MiningRoutine_Basic'" default="true">
						<param name="warebasket" value="$locbasket"/>
						<param name="range" value="$refsector"/>
						<param name="minbuy" value="0"/>
						<param name="maxbuy" value="0"/>
						<param name="minsell" value="0"/>
						<param name="maxsell" value="0"/>
						<param name="debugchance" value="$defaultorder.$debugchance"/>
						<param name="debugchance2" value="$defaultorder.$debugchance2"/>
					</create_order>
				</do_if>
				<remove_value name="$resourcesector"/>
				<remove_value name="$resourcepos"/>
				<remove_value name="$locbasket"/>
				<remove_value name="$refsector"/>
			</do_if>
		</do_elseif>

		<do_elseif value="@$playerminers.{$i}.pilot.combinedskill ge 20">
			<set_value name="$refsector" exact="@$playerminers.{$i}.sector"/>
			<do_if value="not $refsector and $playerminers.{$i}.zone.issuperhighway and $playerminers.{$i}.zone.destination and $playerminers.{$i}.zone.destination.sector">
				<set_value name="$refsector" exact="$playerminers.{$i}.zone.destination.sector"/>
			</do_if>
			<set_value name="$locbasket" exact="if $defaultorder.$warebasket.count then $defaultorder.$warebasket.random else $defaultorder.$warebasket"/>
			<do_if value="$refsector.exists and $defaultorder.$warebasket.count">
				<do_all exact="$defaultorder.$warebasket.count" counter="$j">
					<find_closest_resource ware="$defaultorder.$warebasket.{$j}" refobject="$playerminers.{$i}" sector="$resourcesector" position="$resourcepos"/>
					<do_if value="$resourcesector.exists and ($refsector == $resourcesector)">
						<set_value name="$locbasket" exact="$defaultorder.$warebasket.{$j}"/>
						<break/>
					</do_if>
				</do_all>
			</do_if>
			<create_order object="$playerminers.{$i}" id="'MiningRoutine_BasicMid'" default="true">
				<param name="warebasket" value="$locbasket"/>
				<param name="range" value="$refsector"/>
				<param name="minbuy" value="0"/>
				<param name="maxbuy" value="0"/>
				<param name="minsell" value="0"/>
				<param name="maxsell" value="0"/>
				<param name="debugchance" value="$defaultorder.$debugchance"/>
				<param name="debugchance2" value="$defaultorder.$debugchance2"/>
			</create_order>
			<do_if value="@$playerminers.{$i}.defaultorder.id != 'MiningRoutine_BasicMid'">
				<create_order object="$playerminers.{$i}" id="'MiningRoutine_Basic'" default="true">
					<param name="warebasket" value="$locbasket"/>
					<param name="range" value="$refsector"/>
					<param name="minbuy" value="0"/>
					<param name="maxbuy" value="0"/>
					<param name="minsell" value="0"/>
					<param name="maxsell" value="0"/>
					<param name="debugchance" value="$defaultorder.$debugchance"/>
					<param name="debugchance2" value="$defaultorder.$debugchance2"/>
				</create_order>
			</do_if>
			<remove_value name="$resourcesector"/>
			<remove_value name="$resourcepos"/>
			<remove_value name="$locbasket"/>
			<remove_value name="$refsector"/>
		</do_elseif>
	</add>

	<!-- TRADE: remplacement du do_if parent -->
	<replace sel="/mdscript/cues/cue[@name='Start']/patch[@sinceversion='23']//do_for_each/do_if[@value=&quot;(@$locship.defaultorder.id == 'TradeRoutine') and not @$locship.commander&quot;]">
		<do_if value="(@$locship.defaultorder.id == 'TradeRoutine') and not @$locship.commander">
			<set_value name="$defaultorder" exact="$locship.defaultorder"/>

			<do_if value="@$locship.pilot.combinedskill ge 80">
				<create_order object="$locship" id="'TradeRoutine_Expert'" default="true">
					<param name="warebasket" value="$defaultorder.$warebasket"/>
					<param name="range" value="$defaultorder.$range"/>
					<param name="minbuy" value="$defaultorder.$minbuy"/>
					<param name="maxbuy" value="$defaultorder.$maxbuy"/>
					<param name="minsell" value="$defaultorder.$minsell"/>
					<param name="maxsell" value="$defaultorder.$maxsell"/>
					<param name="debugchance" value="$defaultorder.$debugchance"/>
					<param name="debugchance2" value="$defaultorder.$debugchance2"/>
				</create_order>
				<do_if value="@$locship.defaultorder.id != 'TradeRoutine_Expert'">
					<create_order object="$locship" id="'TradeRoutine_Advanced'" default="true">
						<param name="warebasket" value="$defaultorder.$warebasket"/>
						<param name="range" value="$defaultorder.$range"/>
						<param name="minbuy" value="$defaultorder.$minbuy"/>
						<param name="maxbuy" value="$defaultorder.$maxbuy"/>
						<param name="minsell" value="$defaultorder.$minsell"/>
						<param name="maxsell" value="$defaultorder.$maxsell"/>
						<param name="debugchance" value="$defaultorder.$debugchance"/>
						<param name="debugchance2" value="$defaultorder.$debugchance2"/>
					</create_order>
				</do_if>
			</do_if>

			<do_elseif value="@$locship.pilot.combinedskill ge 60">
				<create_order object="$locship" id="'TradeRoutine_Advanced'" default="true">
					<param name="warebasket" value="$defaultorder.$warebasket"/>
					<param name="range" value="$defaultorder.$range"/>
					<param name="minbuy" value="$defaultorder.$minbuy"/>
					<param name="maxbuy" value="$defaultorder.$maxbuy"/>
					<param name="minsell" value="$defaultorder.$minsell"/>
					<param name="maxsell" value="$defaultorder.$maxsell"/>
					<param name="debugchance" value="$defaultorder.$debugchance"/>
					<param name="debugchance2" value="$defaultorder.$debugchance2"/>
				</create_order>
			</do_elseif>

			<do_elseif value="@$locship.pilot.combinedskill ge 40">
				<create_order object="$locship" id="'TradeRoutine_Standard'" default="true">
					<param name="maxwares" value="$defaultorder.$maxwares"/>
					<param name="warebasket" value="$defaultorder.$warebasket"/>
					<param name="range" value="$defaultorder.$range"/>
					<param name="minbuy" value="$defaultorder.$minbuy"/>
					<param name="maxbuy" value="$defaultorder.$maxbuy"/>
					<param name="minsell" value="$defaultorder.$minsell"/>
					<param name="maxsell" value="$defaultorder.$maxsell"/>
					<param name="debugchance" value="$defaultorder.$debugchance"/>
					<param name="debugchance2" value="$defaultorder.$debugchance2"/>
				</create_order>
				<do_if value="@$locship.defaultorder.id != 'TradeRoutine_Standard'">
					<set_value name="$refsector" exact="@$locship.sector"/>
					<do_if value="not $refsector and $locship.zone.issuperhighway and $locship.zone.destination and $locship.zone.destination.sector">
						<set_value name="$refsector" exact="$locship.zone.destination.sector"/>
					</do_if>
					<set_value name="$locbasket" exact="if $defaultorder.$warebasket.count then $defaultorder.$warebasket.random else $defaultorder.$warebasket"/>
					<create_order object="$locship" id="'TradeRoutine_BasicMid'" default="true">
						<param name="warebasket" value="$locbasket"/>
						<param name="range" value="$refsector"/>
						<param name="minbuy" value="0"/>
						<param name="maxbuy" value="0"/>
						<param name="minsell" value="0"/>
						<param name="maxsell" value="0"/>
						<param name="debugchance" value="$defaultorder.$debugchance"/>
						<param name="debugchance2" value="$defaultorder.$debugchance2"/>
					</create_order>
					<do_if value="@$locship.defaultorder.id != 'TradeRoutine_BasicMid'">
						<create_order object="$locship" id="'TradeRoutine_Basic'" default="true">
							<param name="warebasket" value="$locbasket"/>
							<param name="range" value="$refsector"/>
							<param name="minbuy" value="0"/>
							<param name="maxbuy" value="0"/>
							<param name="minsell" value="0"/>
							<param name="maxsell" value="0"/>
							<param name="debugchance" value="$defaultorder.$debugchance"/>
							<param name="debugchance2" value="$defaultorder.$debugchance2"/>
						</create_order>
					</do_if>
					<remove_value name="$locbasket"/>
					<remove_value name="$refsector"/>
				</do_if>
			</do_elseif>

			<do_elseif value="@$locship.pilot.combinedskill ge 20">
				<set_value name="$refsector" exact="@$locship.sector"/>
				<do_if value="not $refsector and $locship.zone.issuperhighway and $locship.zone.destination and $locship.zone.destination.sector">
					<set_value name="$refsector" exact="$locship.zone.destination.sector"/>
				</do_if>
				<set_value name="$locbasket" exact="if $defaultorder.$warebasket.count then $defaultorder.$warebasket.random else $defaultorder.$warebasket"/>
				<create_order object="$locship" id="'TradeRoutine_BasicMid'" default="true">
					<param name="warebasket" value="$locbasket"/>
					<param name="range" value="$refsector"/>
					<param name="minbuy" value="0"/>
					<param name="maxbuy" value="0"/>
					<param name="minsell" value="0"/>
					<param name="maxsell" value="0"/>
					<param name="debugchance" value="$defaultorder.$debugchance"/>
					<param name="debugchance2" value="$defaultorder.$debugchance2"/>
				</create_order>
				<do_if value="@$locship.defaultorder.id != 'TradeRoutine_BasicMid'">
					<create_order object="$locship" id="'TradeRoutine_Basic'" default="true">
						<param name="warebasket" value="$locbasket"/>
						<param name="range" value="$refsector"/>
						<param name="minbuy" value="0"/>
						<param name="maxbuy" value="0"/>
						<param name="minsell" value="0"/>
						<param name="maxsell" value="0"/>
						<param name="debugchance" value="$defaultorder.$debugchance"/>
						<param name="debugchance2" value="$defaultorder.$debugchance2"/>
					</create_order>
				</do_if>
				<remove_value name="$locbasket"/>
				<remove_value name="$refsector"/>
			</do_elseif>

			<do_else>
				<set_value name="$refsector" exact="@$locship.sector"/>
				<do_if value="not $refsector and $locship.zone.issuperhighway and $locship.zone.destination and $locship.zone.destination.sector">
					<set_value name="$refsector" exact="$locship.zone.destination.sector"/>
				</do_if>
				<set_value name="$locbasket" exact="$defaultorder.$warebasket.random"/>
				<create_order object="$locship" id="'TradeRoutine_Basic'" default="true">
					<param name="warebasket" value="$locbasket"/>
					<param name="range" value="$refsector"/>
					<param name="minbuy" value="0"/>
					<param name="maxbuy" value="0"/>
					<param name="minsell" value="0"/>
					<param name="maxsell" value="0"/>
					<param name="debugchance" value="$defaultorder.$debugchance"/>
					<param name="debugchance2" value="$defaultorder.$debugchance2"/>
				</create_order>
				<remove_value name="$locbasket"/>
				<remove_value name="$refsector"/>
			</do_else>

			<remove_value name="$defaultorder"/>
		</do_if>
	</replace>
</diff>﻿<?xml version="1.0" encoding="utf-8"?>
<!--  translated into russian by Alex5Not   -->
<diff>
	<add sel="/language">

	<page id="1819190163" voice="no">
		<t id="1">Базовая Авто-торговля</t>
		<t id="2">Позволяет вам торговать, покупая и продавая один ресурс в радиусе от 1 до 4 секторов, в зависимости от ваших навыков пилотирования или управления.</t>
	</page>

	</add>
</diff>
<?xml version="1.0" encoding="utf-8"?>
<diff>
<add sel="/language">
	<page id="1819190163" voice="no">
		<t id="1">Commerce basique auto</t>
		<t id="2">Permet de commercer en achetant et vendant une unique ressource dans un rayon de 1 à 4 secteurs en fonction de vos compétences de pilotages ou de gestion.</t>		
	</page>
</add>
</diff>
<?xml version="1.0" encoding="utf-8"?>
<language>
	<page id="1819190163" voice="no">
		<t id="1">Basic AutoTrade</t>
		<t id="2">Allows you to trade by buying and selling a single resource within a radius of 1 to 4 sectors depending on your piloting or management skills.</t>
		</page>
</language>


