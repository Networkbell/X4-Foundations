<?xml version="1.0" encoding="utf-8"?>
<diff>

	<add sel="/aiscript/order/params">
		<param name="effectiveskill" default="this.ship.combinedskill" type="internal" comment="Effective skill level used for range factor (Expert = 100)"/>
	</add>


	<replace sel="/aiscript/init//do_if[@value=&quot;(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced')&quot;]">
		<do_if value="(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced') or (this.assignedcontrolled.order.id == 'TradeRoutine_BasicMid') or (this.assignedcontrolled.order.id == 'TradeRoutine_Standard') or (this.assignedcontrolled.order.id == 'TradeRoutine_Expert')">
			<set_value name="$thisorder" exact="this.assignedcontrolled.order"/>
		</do_if>
	</replace>

	<replace sel="/aiscript/patch[@sinceversion='10']//do_if[@value=&quot;(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced')&quot;]">
		<do_if value="(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced') or (this.assignedcontrolled.order.id == 'TradeRoutine_BasicMid') or (this.assignedcontrolled.order.id == 'TradeRoutine_Standard') or (this.assignedcontrolled.order.id == 'TradeRoutine_Expert')">
			<set_value name="$thisorder" exact="this.assignedcontrolled.order"/>
		</do_if>
	</replace>

	<replace sel="/aiscript/attention//do_if[@value=&quot;(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced')&quot;]">
		<do_if value="(this.assignedcontrolled.order.id == 'TradeRoutine') or (this.assignedcontrolled.order.id == 'TradeRoutine_Basic') or (this.assignedcontrolled.order.id == 'TradeRoutine_Advanced') or (this.assignedcontrolled.order.id == 'TradeRoutine_BasicMid') or (this.assignedcontrolled.order.id == 'TradeRoutine_Standard') or (this.assignedcontrolled.order.id == 'TradeRoutine_Expert')">
			<set_order_syncpoint_reached order="this.assignedcontrolled.order"/>
		</do_if>
	</replace>

	<replace sel="/aiscript/init/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']">
		<set_value name="$maxrange" exact="[@this.assignedcontrolled.commander.tradenpc.skill.management, @this.skill.piloting].max / 3"/>
	</replace>
	<add sel="/aiscript/init/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']" position="after">
		<do_if value="$effectiveskill == 100">
			<set_value name="$maxrange" exact="$maxrange * 2"/>
		</do_if>
	</add>

	<replace sel="/aiscript/patch[@sinceversion='7']/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']">
		<set_value name="$maxrange" exact="[@this.assignedcontrolled.commander.tradenpc.skill.management, @this.assignedcontrolled.pilot.skill.piloting].max / 3"/>
	</replace>
	<add sel="/aiscript/patch[@sinceversion='7']/do_if[@value='this.isplayerowned']/set_value[@name='$maxrange']" position="after">
		<do_if value="$effectiveskill == 100">
			<set_value name="$maxrange" exact="$maxrange * 2"/>
		</do_if>
	</add>
</diff>
